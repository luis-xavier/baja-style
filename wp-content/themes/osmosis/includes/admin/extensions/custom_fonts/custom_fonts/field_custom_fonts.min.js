!function(e){"use strict";var t,n;redux=redux||{},redux.field_objects=redux.field_objects||{},redux.field_objects.custom_fonts=redux.field_objects.custom_fonts||{};var o=!1;redux.field_objects.custom_fonts.init=function(t){t||(t=e(document).find(".redux-group-tab:visible").find(".redux-container-custom_font:visible")),e(t).each(function(){var t=e(this),n=t;t.hasClass("redux-field-container")||(n=t.parents(".redux-field-container:first")),n.is(":hidden")||n.hasClass("redux-field-init")&&(n.removeClass("redux-field-init"),redux.field_objects.custom_fonts.modInit(t))})},redux.field_objects.custom_fonts.modInit=function(o){t=redux_custom_fonts_l10;var i=e(".redux-ajax-security").data("opt-name");n=void 0===i?redux:redux.optName,o.find(".remove-font").unbind("click").on("click",function(){redux.field_objects.custom_fonts.remove_font(o,e(this).parents("fieldset.redux-field:first"))}),o.find(".media_add_font").unbind().on("click",function(t){redux.field_objects.custom_fonts.add_font(o,t,e(this).parents("fieldset.redux-field:first"))}),o.find(".fontDelete").on("click",function(n){n.preventDefault();var o=e(this).parents("td:first");o.find(".spinner").show();var i=e(this).data();return i.action="redux_custom_fonts",i.nonce=e(this).parents(".redux-container-custom_font:first").find(".media_add_font").attr("data-nonce"),e.post(ajaxurl,i,function(n){(n=e.parseJSON(n)).type&&"success"==n.type?1==o.parents("table:first").find("tr").length?o.parents("table:first").fadeOut().remove():o.parents("tr:first").fadeOut().remove():(alert(t.delete_error+" "+n.msg),o.find(".spinner").hide())}),!1})},redux.field_objects.custom_fonts.startTimer=function(i,s){var r;e.ajax({url:ajaxurl,type:"POST",data:{action:"redux_custom_font_timer"},beforeSend:function(){},success:function(d){var a;0==o?(setTimeout(redux.field_objects.custom_fonts.startTimer(i,s),500),a=n.args.please_wait+": "+s+"<br><br>"+d):(a=t.complete,d="finished"),""!=d&&d!=r&&(e(".blockUI.blockMsg h2").html(a),r=d)}})},redux.field_objects.custom_fonts.add_font=function(i,s,r){var d;s.preventDefault(),d?d.open():((d=wp.media({multiple:!1,library:{type:["application","font"]},title:"Redux Custom Fonts:  "+t.media_title,button:{text:t.media_button}})).on("click",function(){}),d.on("select",function(){var s=d.state().get("selection").first(),a=r.find(".font-error");if(a.slideUp(),a.find("span").text(""),d.close(),"application"===s.attributes.type||"font"===s.attributes.type){var u={action:"redux_custom_fonts",nonce:e(r).find(".media_add_font").attr("data-nonce"),attachment_id:s.id,title:s.attributes.title,mime:s.attributes.mime};if(console.log(s),"application/zip "==u.mime)var f=t.unzip;else f=t.convert;redux.field_objects.custom_fonts.startTimer(i,f),e.blockUI({message:"<h2>"+n.args.please_wait+": "+f+"</h2>"}),e.post(ajaxurl,u,function(n){if(console.log("Redux Custom Fonts API Response (For support purposes)"),console.log(n),"success"==(n=e.parseJSON(n)).type){if(""!=n.msg)return e.unblockUI(),a.find("span").text(n.msg+"  "+t.partial),a.slideDown(),void(o=!0);window.onbeforeunload="",location.reload()}else"error"==n.type?(e.unblockUI(),a.find("span").text(n.msg),a.slideDown()):(e.unblockUI(),a.find("span").text(t.unknown),a.slideDown());o=!0})}}),d.open())},redux.field_objects.custom_fonts.remove_font=function(e,t){t.find(".remove-image").addClass("hide")},redux.field_objects.custom_fonts.sleep=function(e){for(var t=(new Date).getTime(),n=0;n<1e7&&!((new Date).getTime()-t>e);n++);}}(jQuery);